#include "network_evaluate_tof.h"


// attention stuff
#define D_MODEL 12
#define NUM_TOKENS 2
#define EPS 0.000001 // 1e-6

static float tokens[NUM_TOKENS][D_MODEL];
static float q_outputs[NUM_TOKENS][D_MODEL];
static float k_outputs[NUM_TOKENS][D_MODEL];
static float v_outputs[NUM_TOKENS][D_MODEL];
static float residual[NUM_TOKENS][D_MODEL];

static float attn_weights[NUM_TOKENS][NUM_TOKENS];
static float softmax_sums[NUM_TOKENS];
static float query_output[NUM_TOKENS][D_MODEL];
static float query_embeds[NUM_TOKENS][D_MODEL];

static float last_layer_means[NUM_TOKENS];
static float last_layer_variances[NUM_TOKENS];
static float attn_embeds[NUM_TOKENS][D_MODEL];

static float output_embeds[3 * D_MODEL];
static float obstacle_embeds[12];
static float neighbor_embeds[12];

float base;
float exponent;
static const int self_structure [3][2] = {{18, 12},{36, 12},{12, 4}};
static const int nbr_structure [1][2] = {{6, 12}};
static const int obst_structure [1][2] = {{16, 12}};
static const int attn_structure [4][2] = {{12, 12},{12, 12}};
static float output_0[12];
static float nbr_output_0[12];
static float obst_output_0[12];
static float output_1[12];
static float output_2[4];
static const float actor_encoder_self_embed_layer_0_weight[18][12] = {{-0.12626126408576965,0.02258187346160412,-0.13156729936599731,0.06987516582012177,-0.19053511321544647,-0.002750612795352936,0.06328386813402176,-0.6563369631767273,0.08347966521978378,0.051224593073129654,-0.022513702511787415,0.1876281201839447},{0.09795729070901871,-0.3092811703681946,0.2083650827407837,-0.11835482716560364,-0.05528082326054573,0.2637721300125122,0.16059720516204834,0.08280540257692337,0.023623913526535034,0.006463152822107077,0.04480098560452461,-0.10986729711294174},{-0.19858227670192719,0.1102612316608429,0.20838165283203125,0.46431827545166016,-0.4723113775253296,-0.2905595600605011,-0.47213780879974365,0.1190991997718811,-0.6971326470375061,-0.21883535385131836,0.02616540528833866,-0.27519822120666504},{0.2811354100704193,0.21689695119857788,-0.007430592086166143,0.018092015758156776,-0.0905991792678833,0.2171030342578888,-0.14883796870708466,-0.5455830693244934,-0.014237092807888985,-0.5293638706207275,0.017998358234763145,0.14875876903533936},{-0.11057912558317184,-0.4355991780757904,-0.027750452980399132,0.1217813566327095,-0.16443949937820435,0.12948951125144958,0.47794485092163086,-0.13022996485233307,-0.0003307839797344059,-0.21998034417629242,-0.3946957588195801,-0.33793550729751587},{-0.32314392924308777,-0.3207506537437439,0.5044685006141663,0.3401767909526825,-0.4170069992542267,0.19553327560424805,-0.16620226204395294,-0.17787668108940125,-0.2168809026479721,-0.06047230213880539,0.5288006663322449,-0.12646259367465973},{0.22550098598003387,0.005429165903478861,-0.5136402249336243,-0.4177599251270294,-0.1864897906780243,-0.42983388900756836,-0.09009547531604767,0.19871242344379425,0.2060565948486328,0.2890927493572235,-0.047953084111213684,-0.37045279145240784},{0.4321229159832001,0.9258082509040833,0.5135841965675354,0.46716630458831787,-0.41955849528312683,0.9490721225738525,0.27805522084236145,0.3864564597606659,-0.0421639159321785,0.521037220954895,-0.4195033609867096,0.3378893733024597},{0.7545713186264038,0.5771552324295044,-0.24468660354614258,-0.008553440682590008,-0.24584762752056122,-0.19067524373531342,0.3706885874271393,-0.13397441804409027,-0.24609586596488953,-0.7527850866317749,-0.1547141671180725,-0.09475336968898773},{0.21839798986911774,-0.2734048068523407,-0.35397425293922424,-0.5387082695960999,0.2250669300556183,-1.1964831352233887,0.037932973355054855,-0.33629611134529114,0.06777128577232361,-0.27240172028541565,0.17414326965808868,0.0007166440482251346},{-0.09849192947149277,0.4798446297645569,0.1591476947069168,-0.1991960108280182,-0.31080862879753113,0.3570789098739624,-0.18452811241149902,-0.00991078931838274,0.02893703803420067,-0.0911949872970581,-0.34189242124557495,-0.28764450550079346},{-0.19460678100585938,-0.6198844909667969,-0.4500355124473572,0.4947449266910553,-0.13683103024959564,0.5911390781402588,0.12289862334728241,-0.547024130821228,0.015965184196829796,-0.5052682757377625,-0.5339788198471069,-0.6440691351890564},{-0.9994459748268127,-0.2265288382768631,0.743094265460968,-0.028058186173439026,0.3566291332244873,0.13980722427368164,0.42049440741539,0.8192875981330872,0.09434196352958679,0.7794689536094666,-0.09628556668758392,-0.2470986545085907},{0.33030349016189575,0.3484472334384918,-0.03097858652472496,-0.37958505749702454,-0.08454660326242447,-0.3656410574913025,-0.09680941700935364,-0.06295587122440338,-0.185438871383667,0.42405930161476135,0.6690411567687988,0.44745907187461853},{-0.45568299293518066,-0.10074672847986221,-0.5818474292755127,-0.00941652711480856,-0.03321513533592224,0.4241328239440918,0.20820149779319763,0.328555166721344,0.4493354856967926,-0.22439122200012207,0.0902400016784668,0.06388457864522934},{0.08425413072109222,0.13126523792743683,0.034239258617162704,0.08292140811681747,-0.3289581835269928,-0.22888422012329102,0.04799915850162506,0.1728014051914215,0.11737199127674103,0.326201856136322,0.31902506947517395,0.36395028233528137},{0.2928414046764374,0.1348634660243988,-0.39694634079933167,-0.20224009454250336,0.10109879076480865,0.175898015499115,0.11207375675439835,-0.2506982982158661,-0.5442406535148621,-0.2624124586582184,0.04557277634739876,-0.29254356026649475},{-0.20105457305908203,-0.18828020989894867,-0.2627089023590088,-0.08841210603713989,0.49690133333206177,-0.46153736114501953,0.3254142701625824,-0.14357124269008636,-0.3248952329158783,-0.42948487401008606,0.2683636248111725,-0.11775771528482437}};
static const float actor_encoder_feed_forward_0_weight[36][12] = {{0.5030818581581116,0.6517557501792908,-0.14147202670574188,0.07224525511264801,0.08169873803853989,0.30041971802711487,0.2391226440668106,0.14610373973846436,-0.3211817443370819,0.11975192278623581,0.026947539299726486,0.22659246623516083},{0.13174985349178314,0.015514875762164593,0.29253047704696655,0.29465752840042114,0.351359099149704,-0.24912680685520172,0.1358300745487213,0.3611716628074646,0.2554611265659332,-0.21184726059436798,-0.5112034678459167,0.3397566080093384},{-0.21352769434452057,-0.27189746499061584,-0.0028605542611330748,-0.040865737944841385,0.07662229239940643,0.12378546595573425,-0.13422495126724243,0.19763590395450592,0.1736026108264923,-0.31613585352897644,-0.2441919893026352,0.08785048127174377},{0.0257661584764719,-0.04129086807370186,-0.06152966991066933,0.2596357762813568,-0.2371862679719925,0.2813733220100403,-0.33601251244544983,0.2805541455745697,-0.2801632583141327,-0.3068860173225403,-0.0803079754114151,-0.023816749453544617},{-0.07259226590394974,0.13718070089817047,0.36154603958129883,-0.24823850393295288,0.06587272882461548,-0.2959335148334503,-0.022294754162430763,-0.3545357286930084,-0.03763442486524582,-0.14502346515655518,0.4533352553844452,-0.19397760927677155},{-0.07830198854207993,0.26050469279289246,-0.12453663349151611,0.4765448272228241,-0.2185625582933426,-0.12359460443258286,0.20748822391033173,0.08779668062925339,-0.02757488191127777,-0.037672802805900574,-0.6798228621482849,0.33569982647895813},{0.34953224658966064,0.09742850810289383,-0.03099135309457779,0.2883351445198059,0.15202344954013824,-0.05633050203323364,-0.05314449220895767,-0.11806369572877884,-0.0971461683511734,-0.13139209151268005,-0.008354582823812962,-0.5556821227073669},{0.050927504897117615,-0.29098647832870483,0.30681556463241577,0.28655481338500977,-0.17868627607822418,-0.2470272332429886,-0.20040400326251984,-0.46571630239486694,0.2529613971710205,0.04975619539618492,-0.01266703475266695,0.04835767298936844},{0.16530786454677582,-0.20607121288776398,-0.05694818124175072,0.08173473179340363,0.1044069156050682,-0.4054641127586365,0.25905951857566833,-0.2687501609325409,-0.08885848522186279,0.053994789719581604,-0.03939956799149513,-0.2549920678138733},{-0.2800859808921814,0.12343578785657883,0.19774073362350464,0.3068495988845825,0.2736125588417053,-0.3298549950122833,-0.2656330168247223,-0.46592801809310913,0.008576962165534496,-0.4755212664604187,-0.1940554827451706,0.14294379949569702},{0.42750516533851624,0.08247292786836624,0.057993728667497635,-0.4781479835510254,0.1698262244462967,0.01596212573349476,-0.07304062694311142,-0.030477995052933693,0.12237539142370224,0.2363346964120865,0.3950411081314087,0.3562782108783722},{-0.05168118700385094,0.2874608635902405,0.29499027132987976,-0.19924446940422058,-0.004731768276542425,-0.2577981650829315,-0.14403481781482697,0.17475001513957977,0.3129846453666687,-0.06916047632694244,-0.02096833661198616,0.007882051169872284},{-0.2742330729961395,0.09052935242652893,-0.37770652770996094,-0.11794143915176392,0.17269812524318695,0.1677282452583313,0.21819232404232025,0.22998254001140594,0.27733153104782104,0.009931251406669617,0.07080383598804474,-0.3607150614261627},{-0.23160642385482788,0.006848215125501156,-0.23877650499343872,0.011118409223854542,0.17598260939121246,0.2774118185043335,-0.12745250761508942,-0.05731327459216118,-0.3092504143714905,-0.16227556765079498,-0.33059999346733093,0.01370798796415329},{-0.1419481337070465,-0.18831543624401093,-0.19491703808307648,-0.11007949709892273,-0.015315305441617966,-0.006276008207350969,-0.13423669338226318,0.19544750452041626,0.14828117191791534,0.09210163354873657,0.2631162703037262,0.06108124181628227},{0.2344685047864914,-0.22519230842590332,-0.190937340259552,0.2522478997707367,0.13568976521492004,-0.17033304274082184,0.053682196885347366,0.0499173179268837,0.26368191838264465,0.23473377525806427,0.25993791222572327,-0.26383042335510254},{0.007861110381782055,0.20921187102794647,-0.00871255248785019,0.07121069729328156,0.13071584701538086,0.08545642346143723,0.24186009168624878,-0.0415610671043396,-0.21156559884548187,0.008048282004892826,-0.16451872885227203,-0.1518620401620865},{-0.11914340406656265,0.15274405479431152,0.21891003847122192,0.30514511466026306,-0.05345116928219795,0.30265378952026367,0.18137767910957336,0.012175432406365871,-0.12947937846183777,-0.10258397459983826,-0.04246702790260315,0.2076539248228073},{-0.09639083594083786,-0.044897500425577164,0.22532935440540314,0.027450889348983765,0.15078090131282806,0.1779484897851944,-0.3289039134979248,-0.163167342543602,0.20535625517368317,0.22307188808918,0.1519578993320465,-0.1584971845149994},{-0.042332448065280914,-0.034690890461206436,0.22254611551761627,0.07560917735099792,-0.05098244175314903,-0.04641393944621086,-0.1573999673128128,0.11826121062040329,0.0760590210556984,0.32384371757507324,-0.01310891006141901,-0.12414708733558655},{-0.12299449741840363,0.26571545004844666,-0.04389889910817146,0.2519479990005493,0.18529359996318817,0.04755999520421028,0.010146922431886196,-0.3488593101501465,0.49368202686309814,0.2837525010108948,-0.15812507271766663,0.2586522102355957},{-0.09439872205257416,0.2164352536201477,-0.061628591269254684,-0.09759922325611115,-0.06255059689283371,0.14547522366046906,-0.22074466943740845,-0.0001841133343987167,-0.011105608195066452,0.14393073320388794,0.0036953394301235676,-0.024942398071289062},{0.12476523965597153,0.07093267887830734,0.10486696660518646,-0.17708852887153625,0.03010784462094307,0.17433613538742065,0.21923577785491943,-0.1682678610086441,0.21915462613105774,0.41519081592559814,0.23366136848926544,-0.055346764624118805},{-0.12236665189266205,0.26080575585365295,0.1988261491060257,0.3224261403083801,0.170779749751091,-0.011786557734012604,0.02452312596142292,-0.03382768854498863,-0.3276388645172119,-0.0027823089621961117,0.11484027653932571,-0.16160590946674347},{-0.1661376804113388,-0.01701168715953827,0.3241766393184662,-0.26593926548957825,0.11991159617900848,0.019676022231578827,-0.07790552824735641,-0.291845440864563,-0.04475963115692139,0.14626894891262054,-0.26427772641181946,0.27625665068626404},{-0.21736864745616913,0.13348202407360077,0.24926528334617615,0.06134910508990288,-0.025038089603185654,0.21068795025348663,-0.29828643798828125,-0.04368050396442413,0.11252425611019135,0.2277199625968933,0.06717529892921448,-0.2265177071094513},{0.3645542562007904,0.4745347797870636,0.23135095834732056,-0.14727385342121124,0.3076772689819336,0.3205533027648926,0.08282195776700974,0.04246990755200386,-0.1765119582414627,0.12172352522611618,-0.2837013602256775,0.27296823263168335},{0.2926349937915802,0.20080560445785522,0.22030852735042572,0.15187038481235504,0.06066083163022995,-0.11996480822563171,-0.0062382104806602,0.19227071106433868,0.033323079347610474,-0.02908887341618538,0.34901443123817444,0.10908471047878265},{0.16397352516651154,-0.3772297501564026,-0.014112275093793869,0.2701129913330078,0.14031106233596802,-0.31376975774765015,-0.021228009834885597,0.24250108003616333,-0.012397823855280876,-0.026293141767382622,-0.0264445710927248,0.3130934536457062},{-0.08363144099712372,0.1174691915512085,-0.25772327184677124,-0.38660985231399536,0.2968375086784363,-0.0904020369052887,-0.17411652207374573,0.07904548943042755,-0.09559277445077896,-0.14733901619911194,-0.14605505764484406,-0.230546236038208},{-0.015052957460284233,-0.24025805294513702,0.1712883710861206,0.17973056435585022,0.03812733292579651,-0.1629936248064041,0.17185966670513153,-0.01168496161699295,-0.28523126244544983,0.031115375459194183,-0.3374231457710266,-0.24897915124893188},{0.1901676207780838,-0.2082504779100418,-0.3328085243701935,-0.20752540230751038,-0.12163341045379639,-0.2868417203426361,0.17286382615566254,0.11100179702043533,-0.02654830366373062,0.2942923605442047,0.17088209092617035,0.22481577098369598},{-0.02010689117014408,-0.2998107075691223,0.25434932112693787,0.3021858334541321,-0.03765656054019928,-0.22219504415988922,-0.26420676708221436,-0.036000024527311325,0.5147455930709839,0.11587580293416977,0.23412087559700012,0.041810616850852966},{-0.18176604807376862,0.1984737664461136,0.006327776238322258,0.06262124329805374,0.12961240112781525,0.11497102677822113,0.25663572549819946,0.3332003653049469,0.09190075844526291,-0.05577998235821724,-0.07702400535345078,0.12972640991210938},{0.24223679304122925,-0.12476923316717148,-0.2795502841472626,-0.16299691796302795,0.2838020622730255,-0.14026564359664917,0.02719210647046566,-0.006521950475871563,-0.34277233481407166,-0.23297443985939026,0.22640016674995422,-0.3261032998561859},{-0.3705557584762573,0.12748801708221436,-0.2017975151538849,-0.2423328459262848,0.013583021238446236,0.10876615345478058,0.213938370347023,-0.34173375368118286,-0.29474857449531555,-0.4260620176792145,-0.09050498902797699,0.3398432731628418}};
static const float action_parameterization_distribution_linear_weight[12][4] = {{0.5800792574882507,-0.22123312950134277,-0.2836199402809143,0.02131645753979683},{0.3237464129924774,-0.14372873306274414,-0.3543533384799957,0.5622217059135437},{0.13460922241210938,0.21093738079071045,-0.05289183184504509,-0.053244639188051224},{-0.49412408471107483,0.15266837179660797,-0.03593477979302406,0.3801988363265991},{0.5875341296195984,0.4240344762802124,-0.25492894649505615,-0.3018239736557007},{-0.05932002142071724,-0.5301463603973389,-0.19083599746227264,-0.3610013425350189},{0.18006445467472076,-0.1753271073102951,0.29484620690345764,0.5154553651809692},{-0.03521145507693291,-0.33950698375701904,-0.44599634408950806,-0.010574511252343655},{-0.11565229296684265,0.04563998058438301,-0.11525103449821472,-0.13861748576164246},{0.3017989695072174,-0.5546450614929199,-0.5121389031410217,0.4919142425060272},{0.15844780206680298,-0.19748559594154358,0.5497324466705322,-0.31023702025413513},{0.016002191230654716,0.04459342360496521,-0.3311038315296173,-0.35611024498939514}};
static const float actor_encoder_self_embed_layer_0_bias[12] = {-0.07661139219999313,-0.028339814394712448,-0.007415808271616697,-0.07154528796672821,0.08531717211008072,0.004073213320225477,0.05745987594127655,0.05293292552232742,0.009452496655285358,0.09365648031234741,-0.016726752743124962,-0.06926590949296951};
static const float actor_encoder_feed_forward_0_bias[12] = {-0.0404982827603817,-0.0009981236653402448,0.03560297563672066,0.006219996605068445,0.0459279790520668,0.03864220902323723,0.046987686306238174,-0.020472168922424316,-0.20796863734722137,-0.1174076646566391,-0.04362529516220093,0.007865648716688156};
static const float action_parameterization_distribution_linear_bias[4] = {-0.02894347533583641,0.032859474420547485,-0.02431962825357914,-0.004023027140647173};
static const float actor_encoder_neighbor_embed_layer_0_weight[6][12] = {{0.14006873965263367,-0.10254515707492828,0.1539413183927536,-0.2479650378227234,-0.39364510774612427,0.03631732240319252,-0.2034304141998291,0.10232428461313248,-0.24243783950805664,0.09176576137542725,0.06488381326198578,0.35742831230163574},{-0.2963327467441559,-0.46936726570129395,-0.42282232642173767,-0.20034074783325195,-0.2881908714771271,0.185161292552948,0.12148364633321762,0.12444420158863068,-0.2761548161506653,-0.2259148508310318,0.19205226004123688,-0.2870340347290039},{-0.36367151141166687,0.42893165349960327,1.1395736932754517,0.355363667011261,0.14515578746795654,0.47178739309310913,-0.29946351051330566,0.595610499382019,-0.4768015742301941,-0.15968717634677887,0.14583589136600494,0.4804850220680237},{0.2511017322540283,0.2563614249229431,0.6502941250801086,-0.09555764496326447,0.43112191557884216,-0.3371392488479614,-0.3809817433357239,-0.23786486685276031,0.25508978962898254,0.10073165595531464,-0.23546411097049713,0.18422602117061615},{0.4399107098579407,0.2797253727912903,-0.035523250699043274,-0.35988178849220276,-0.3855910897254944,-0.5964171886444092,-0.4061014652252197,-0.08388696610927582,-0.44154229760169983,-0.5171027183532715,-0.7634401321411133,0.23629896342754364},{-0.4422474205493927,0.3018118441104889,0.7947206497192383,0.6222684979438782,0.18001091480255127,0.12690353393554688,-0.3672758936882019,0.4169914126396179,0.2054629772901535,-0.30788806080818176,-0.27981531620025635,-0.29253825545310974}};
static const float actor_encoder_neighbor_embed_layer_0_bias[12] = {0.02885441668331623,-0.017352942377328873,-0.2144727259874344,-0.27571383118629456,0.11853499710559845,-0.03155086934566498,-0.14646577835083008,-0.16207967698574066,0.0003729999007191509,-0.06986866146326065,0.05044417828321457,0.04703159257769585};
static const float actor_encoder_obstacle_embed_layer_0_weight[16][12] = {{0.09200655668973923,0.3068903088569641,-0.3374525308609009,-0.05359286442399025,-0.10437878966331482,-0.27438175678253174,0.11736897379159927,-0.2317584753036499,0.16280874609947205,0.03941576927900314,0.4773457646369934,0.5020320415496826},{0.15787796676158905,-0.09544869512319565,-0.17880219221115112,0.22531144320964813,0.15052515268325806,0.2752855718135834,-0.12024928629398346,-0.35388538241386414,-0.0829584002494812,-0.08947896957397461,-0.04078120365738869,0.33268964290618896},{0.2407238930463791,-0.25192445516586304,-0.09644027799367905,-0.13214631378650665,0.18216922879219055,-0.07184553146362305,0.03307085856795311,0.39235684275627136,-0.05619410425424576,-0.42828530073165894,0.1950150579214096,0.19384880363941193},{-0.017826443538069725,0.4428611695766449,-0.09241073578596115,0.1384691447019577,0.21215520799160004,0.03225148096680641,0.07169356942176819,-0.4683341085910797,0.4120735228061676,-0.02185261994600296,0.29302436113357544,0.474636435508728},{0.24121233820915222,-0.1825563907623291,0.10867063701152802,0.014009498059749603,0.0772322565317154,0.2983168959617615,-0.18760395050048828,-0.37761956453323364,-0.12245068699121475,-0.2797737717628479,0.16432338953018188,0.33200255036354065},{0.3955067992210388,0.24058318138122559,0.20689676702022552,-0.20883885025978088,-0.006626171059906483,-0.12971438467502594,0.21820960938930511,-0.05386072397232056,0.26265856623649597,-0.33114686608314514,0.22091953456401825,0.00983488280326128},{-0.2823388874530792,-0.03497206047177315,0.4586160182952881,0.4123143255710602,0.297555536031723,0.2829671800136566,-0.05404709652066231,0.0022052661515772343,-0.13560287654399872,-0.25216615200042725,-0.1668761521577835,-0.36965012550354004},{0.20779630541801453,-0.1347516030073166,0.3821367621421814,0.2682608366012573,0.29149314761161804,0.2169877141714096,0.11949550360441208,-0.1888224482536316,-0.2544623017311096,-0.007696326822042465,-0.20977003872394562,-0.4342895746231079},{0.0447368286550045,-0.6816076636314392,0.4643964469432831,-0.05960068851709366,-0.19945520162582397,-0.2546365559101105,0.10185051709413528,0.21283070743083954,0.1084560826420784,0.06264439225196838,0.3910166621208191,-0.0007932380540296435},{0.07663744688034058,0.024792838841676712,0.12008101493120193,0.2750340402126312,0.2637889087200165,0.019975285977125168,-0.029812341555953026,-0.13881303369998932,-0.24116939306259155,0.4919360876083374,0.11738697439432144,-0.2529711425304413},{-0.5022004246711731,-0.0018112334655597806,0.04889228567481041,0.4673381745815277,-0.47280609607696533,-0.2469717413187027,0.2669960856437683,-0.32571014761924744,0.280887246131897,-0.2916080355644226,-0.19154097139835358,-0.21557579934597015},{0.08187714964151382,-0.13131751120090485,0.14025448262691498,0.34910500049591064,-0.1967664659023285,-0.7273155450820923,0.04581715539097786,0.33523985743522644,-0.6571643352508545,-0.04038488119840622,0.17936813831329346,-0.1704103797674179},{-0.6435673832893372,-0.45035725831985474,-0.23763246834278107,0.14395402371883392,-0.23068609833717346,-0.47838184237480164,0.15741601586341858,-0.04632467404007912,-0.3811284005641937,-0.05291111767292023,0.29801705479621887,0.15951144695281982},{-0.29065725207328796,0.1288970708847046,0.2895212471485138,0.0376705639064312,0.06553850322961807,0.07561526447534561,-0.1288314014673233,-0.2983635663986206,0.056897249072790146,0.21499061584472656,0.40376684069633484,-0.1419604867696762},{-0.596400797367096,0.36924660205841064,-0.31303927302360535,-0.016087621450424194,-0.19883151352405548,0.3069876432418823,0.32771968841552734,0.5104992985725403,-0.4673764109611511,0.11464383453130722,0.3325549364089966,0.11452975124120712},{-0.09703004360198975,-0.19179204106330872,-0.1967172920703888,-0.1186797022819519,0.48000743985176086,-0.19476106762886047,0.5632402896881104,-0.3315596282482147,0.06976284831762314,-0.09761886298656464,-0.012354204431176186,0.14717057347297668}};
static const float actor_encoder_obstacle_embed_layer_0_bias[12] = {0.04628198966383934,-0.017630573362112045,-0.08690014481544495,-0.004870432894676924,-0.10194729268550873,0.0037955145817250013,-0.02201268821954727,0.04711843281984329,0.033965155482292175,0.05179094150662422,0.10113798081874847,-0.01600978523492813};
static const float actor_encoder_attention_layer_w_qs_weight[12][12] = {{-0.40321752429008484,-0.5176087617874146,0.05605044588446617,-0.33584487438201904,0.2457566112279892,-0.01462503056973219,0.3825156092643738,-0.20683982968330383,0.11697111278772354,-0.19008201360702515,-0.1620885729789734,0.5860766172409058},{-0.3895668685436249,-0.0491718053817749,-0.4511330723762512,-0.009503315202891827,0.3841286599636078,0.29785841703414917,-0.10816793888807297,-0.5185989737510681,0.17049862444400787,-0.729351818561554,-0.1854109913110733,0.07480170577764511},{-0.3249026834964752,0.5148756504058838,0.1325354427099228,-0.4156510829925537,0.1385105401277542,-0.650683581829071,0.042942728847265244,-0.2594809830188751,-0.1586107313632965,0.2665722072124481,0.3654229938983917,0.08578453958034515},{0.2178114801645279,0.2830743193626404,0.2015092819929123,-0.44588831067085266,-0.270752489566803,0.43707355856895447,-0.40139469504356384,-0.07676885277032852,-0.129487082362175,-0.09689544886350632,-0.18959708511829376,-0.10575708001852036},{-0.11404929310083389,0.4007977843284607,0.42910802364349365,-0.372329443693161,0.06918390095233917,-0.659774899482727,-0.45019322633743286,0.4696310758590698,0.2854387164115906,-0.25583818554878235,-0.13421808183193207,0.12886902689933777},{0.013368016108870506,0.30789315700531006,0.20721015334129333,0.41617605090141296,0.08604197204113007,-0.0990588590502739,0.4696347117424011,-0.21737132966518402,0.5699237585067749,-0.3665573000907898,0.25789380073547363,-0.08437730371952057},{0.1823500543832779,-0.22865808010101318,0.5180365443229675,-0.20513871312141418,-0.23158280551433563,0.45345842838287354,0.09353207796812057,-0.3672965466976166,0.5942987203598022,0.1710481494665146,0.5915209054946899,0.19149670004844666},{0.48655372858047485,0.5744044184684753,0.11282215267419815,-0.014651557430624962,-0.32719823718070984,0.3273788094520569,-0.04054112732410431,-0.4115760326385498,-0.07070260494947433,0.29914069175720215,0.21920132637023926,-0.20116816461086273},{0.3527206480503082,0.5980978012084961,0.4187130928039551,0.06953182071447372,-0.14382672309875488,0.02019810490310192,-0.3713023364543915,0.1432691365480423,0.2195574939250946,-0.26394328474998474,-0.22212544083595276,-0.04105282202363014},{0.2337912768125534,-0.17541886866092682,0.6153741478919983,-0.3868762254714966,-0.1697261482477188,-0.32360517978668213,0.22242805361747742,0.6311240196228027,-0.16802147030830383,-0.1944899708032608,-0.2515357732772827,0.06020916998386383},{0.26372453570365906,0.424591064453125,0.04186644032597542,0.12925590574741364,0.008089463226497173,-0.1007848009467125,-0.056623674929142,0.4186261296272278,0.2205973118543625,-0.1525229513645172,-0.38392502069473267,0.07924385368824005},{-0.002419012598693371,0.010644965805113316,0.25135689973831177,-0.23612985014915466,-0.12169075012207031,0.10112838447093964,0.4307993948459625,-0.4693143665790558,-0.3782952129840851,-0.4461033046245575,0.035222362726926804,-0.16221992671489716}};
static const float actor_encoder_attention_layer_w_ks_weight[12][12] = {{0.4320266544818878,0.3376583158969879,-0.17158707976341248,0.20531834661960602,-0.14357106387615204,-0.3526438772678375,0.3939654231071472,-0.3784063756465912,0.10802598297595978,-0.3807407021522522,0.21692217886447906,-0.4642046093940735},{-0.022231539711356163,-0.6037413477897644,-0.038656555116176605,-0.14793530106544495,-0.09863363206386566,-0.24408407509326935,0.09990143775939941,0.3498118221759796,-0.007917278446257114,0.36831557750701904,-0.1003425344824791,0.09428814798593521},{0.30178648233413696,-0.5531010031700134,0.35371294617652893,-0.12764833867549896,-0.5319479703903198,0.2552555203437805,0.3834112584590912,-0.25406089425086975,0.4745498299598694,0.29709410667419434,0.25502341985702515,0.1333695352077484},{-0.5258894562721252,-0.07548188418149948,-0.07753754407167435,-0.3590451180934906,0.08358784765005112,-0.2843354046344757,0.442618727684021,0.006084376480430365,-0.07437589019536972,0.3269592225551605,0.059611573815345764,0.11266680806875229},{0.35245463252067566,-0.4725707173347473,-0.3220122456550598,0.26981765031814575,-0.021564561873674393,0.0946008488535881,0.3842564523220062,0.12962661683559418,0.15022918581962585,0.6372814774513245,0.5452099442481995,-0.37866538763046265},{-0.4673146605491638,-0.5708873271942139,-0.6595805883407593,0.30267518758773804,0.07898657023906708,0.14042022824287415,-0.10570885986089706,-0.08410915732383728,0.018750404939055443,-0.2291424721479416,-0.32315540313720703,-0.04980018362402916},{0.18358252942562103,-0.28467410802841187,-0.2838239073753357,-0.3270857334136963,0.3352425992488861,-0.3948693871498108,-0.3472922146320343,-0.32001566886901855,-0.5998277068138123,0.015509205870330334,0.4677732586860657,-0.059502776712179184},{-0.2501680254936218,-0.693602979183197,0.1677614450454712,0.10873692482709885,-0.19646883010864258,0.04789974167943001,0.1382051557302475,0.7224668860435486,-0.15045246481895447,-0.01850283332169056,0.012720033526420593,0.3139379322528839},{0.3113320767879486,-0.25321999192237854,-0.6419884562492371,-0.054841674864292145,0.31311553716659546,0.3559630215167999,0.1805802881717682,-0.660067617893219,0.11602026969194412,-0.06505043804645538,0.14440108835697174,-0.35305070877075195},{-0.5182716250419617,-0.16876626014709473,-0.3900921642780304,0.6462209224700928,0.08987899124622345,-0.09919105470180511,0.07571601122617722,-0.029116246849298477,-0.6302569508552551,0.22347010672092438,0.004116478376090527,0.38488245010375977},{-0.6271938681602478,0.07680249214172363,-0.21701186895370483,-0.46828821301460266,0.16553056240081787,0.3074589669704437,-0.08817807585000992,-0.0644502118229866,-0.22752311825752258,0.03871123120188713,-0.04141987860202789,0.170762300491333},{0.2726559340953827,0.3462408781051636,-0.0708618238568306,0.020641988143324852,0.3103965222835541,0.4035876393318176,-0.6620185971260071,-0.046786487102508545,0.16426031291484833,0.21607518196105957,0.2477051466703415,-0.12887166440486908}};
static const float actor_encoder_attention_layer_w_vs_weight[12][12] = {{0.07953204959630966,-0.13811887800693512,0.2704150676727295,-0.1163848340511322,0.5902948379516602,-0.3020133674144745,0.2313118427991867,0.05101558566093445,0.14929528534412384,0.41615036129951477,-0.35294777154922485,-0.35841184854507446},{0.3948436379432678,-0.11471927165985107,-0.11182574182748795,0.1567315012216568,0.14381250739097595,-0.4385678470134735,0.5364199876785278,0.43089526891708374,-0.24482287466526031,0.3076501786708832,0.1256261020898819,0.280577689409256},{0.5282144546508789,0.30104678869247437,-0.06794767826795578,0.0022756061516702175,-0.12124692648649216,-0.34274038672447205,0.01493951864540577,-0.33393606543540955,-0.05245320126414299,-0.05962822213768959,0.18673551082611084,0.33458414673805237},{0.3093862235546112,0.09898697584867477,-0.600997805595398,-0.3340612053871155,-0.7327100038528442,-0.5009192228317261,0.0018099407898262143,-0.32426127791404724,0.23658770322799683,-0.13423126935958862,-0.33459120988845825,0.1752232164144516},{-0.3366776406764984,-0.4547634422779083,-0.34177646040916443,0.5202025771141052,0.297882080078125,0.12114743888378143,0.1913021057844162,0.32347625494003296,-0.30055469274520874,-0.4167361259460449,0.298709511756897,0.1983097791671753},{0.329537570476532,0.2849854528903961,0.6289709806442261,-0.010401136241853237,0.41646409034729004,-0.6411116719245911,0.5819606781005859,-0.07401939481496811,-0.0921020433306694,0.25001606345176697,-0.06793993711471558,-0.04715186357498169},{-0.12177091836929321,-0.15328019857406616,0.02594701386988163,0.23897060751914978,-0.6130964756011963,0.2842678129673004,0.15487848222255707,-0.3130013048648834,-0.029445884749293327,0.12852764129638672,0.18084698915481567,-0.19501528143882751},{0.3161095380783081,0.0012577349552884698,0.48907968401908875,-0.4085528552532196,0.3019961416721344,0.4048871099948883,0.19168643653392792,-0.33945542573928833,-0.2668638825416565,-0.037916041910648346,-0.2078211009502411,0.20528602600097656},{-0.17600972950458527,-0.07806115597486496,0.3617437481880188,0.39581498503685,0.34384405612945557,0.1583070307970047,0.4593864679336548,0.4857097268104553,0.448576956987381,0.28501954674720764,-0.33648210763931274,0.5570917129516602},{-0.2877110540866852,0.5742132067680359,0.3127920627593994,-0.2219821661710739,-0.093472421169281,0.3886373043060303,-0.11916401982307434,0.524860680103302,0.2772045433521271,0.08474726229906082,-0.5164052248001099,0.24993790686130524},{0.39383602142333984,-0.3171839118003845,-0.22704830765724182,0.2649577558040619,0.18800507485866547,-0.22658675909042358,-0.5930551886558533,0.2011154592037201,0.18676839768886566,-0.5662236213684082,0.4655265212059021,-0.0213046595454216},{0.18515412509441376,0.10238642245531082,-0.5322049856185913,-0.1668543815612793,-0.20717163383960724,-0.688273012638092,-0.4766227900981903,-0.008158913813531399,0.14600388705730438,-0.1518140286207199,-0.3562893867492676,0.05196700990200043}};
static const float actor_encoder_attention_layer_fc_weight[12][12] = {{-0.30127090215682983,0.22343230247497559,0.31699493527412415,-0.28842025995254517,-0.35620051622390747,0.021740196272730827,0.3374941647052765,-0.39273926615715027,-0.25908565521240234,0.3834664821624756,-0.049194637686014175,-0.38625678420066833},{-0.19789591431617737,0.23069609701633453,0.04056907817721367,-0.27840638160705566,0.22854205965995789,-0.36358025670051575,-0.19942906498908997,0.31056123971939087,0.4402245283126831,0.32989442348480225,0.40568646788597107,-0.568634569644928},{-0.34592097997665405,-0.0940350815653801,-0.28145870566368103,0.06205036863684654,-0.19946527481079102,-0.36619746685028076,0.16169872879981995,-0.25381535291671753,0.6125938296318054,0.25184884667396545,0.18329648673534393,-0.5935637354850769},{-0.23896263539791107,-0.06656880676746368,0.15751658380031586,-0.32682591676712036,0.2761249840259552,0.4839845895767212,0.10346227139234543,-0.40934211015701294,-0.17681866884231567,-0.39141687750816345,0.10157853364944458,-0.053381744772195816},{0.2149883657693863,-0.33116069436073303,-0.04790937155485153,0.13860690593719482,-0.2927793264389038,-0.5583445429801941,-0.4654098451137543,-0.21418748795986176,0.4654361605644226,-0.5292685627937317,-0.15231022238731384,-0.25862985849380493},{-0.13662560284137726,-0.5802243947982788,-0.09835734963417053,0.521746039390564,0.42225366830825806,-0.11985006928443909,-0.2655971944332123,0.3857989013195038,0.1466469019651413,0.06252539902925491,-0.017958858981728554,0.018613392487168312},{0.17967242002487183,0.12187204509973526,0.2569657862186432,0.13092665374279022,0.06686870008707047,0.17771704494953156,0.17240838706493378,0.06801041215658188,0.5426915884017944,-0.2264413684606552,0.08631011843681335,-0.5401926636695862},{-0.5432740449905396,0.2868649661540985,-0.23502324521541595,0.01076518651098013,-0.28008702397346497,-0.5178096890449524,0.29417747259140015,0.32103168964385986,0.6026081442832947,0.37018659710884094,0.42949432134628296,-0.2768777906894684},{0.011116632260382175,0.2028874158859253,0.32890239357948303,-0.3114829957485199,0.5713314414024353,0.0681782066822052,-0.44694623351097107,-0.39377865195274353,0.1037278100848198,0.2617700397968292,0.3771078586578369,0.39584285020828247},{-0.10069738328456879,-0.5145978927612305,-0.1686616688966751,-0.04075818881392479,-0.26233235001564026,-0.6337850093841553,0.14958763122558594,0.018587883561849594,0.11315536499023438,0.12818104028701782,-0.005728754214942455,-0.3330990672111511},{-0.21635237336158752,0.3949173390865326,-0.2198440134525299,-0.1798838973045349,-0.12875960767269135,-0.12562347948551178,-0.3301948606967926,-0.04453589767217636,-0.43156492710113525,0.14755769073963165,0.1826392561197281,0.3362763524055481},{-0.1182447224855423,0.28420379757881165,0.3122290372848511,-0.13697795569896698,-0.567217230796814,-0.0631180927157402,0.2220761924982071,0.3309163451194763,0.3827804923057556,-0.2172536551952362,0.1033775731921196,-0.20558393001556396}};
static const float actor_encoder_attention_layer_layer_norm_weight[12] = {0.7747132778167725,0.7866101861000061,1.0188428163528442,0.7739592790603638,0.7653000950813293,0.8500332832336426,0.7898859977722168,0.9197560548782349,0.9120872020721436,0.7756053805351257,0.7266285419464111,0.8378943800926208};
static const float actor_encoder_attention_layer_layer_norm_bias[12] = {0.15691855549812317,-0.02748662419617176,-0.03742390125989914,-0.0766119435429573,-0.09415031224489212,-0.07403358817100525,-0.006672166287899017,0.04909630864858627,0.06928811967372894,0.126974418759346,-0.013884677551686764,-0.002478570444509387};
void networkEvaluate(struct control_t_n *control_n, const float *state_array) {
        // Self embed layer
        for (int i = 0; i < self_structure[0][1]; i++) {
            output_0[i] = 0;
            for (int j = 0; j < self_structure[0][0]; j++) {
                output_0[i] += state_array[j] * actor_encoder_self_embed_layer_0_weight[j][i];
            }
            output_0[i] += actor_encoder_self_embed_layer_0_bias[i];
            output_0[i] = tanhf(output_0[i]);
        }
    
        // Concat self_embed, neighbor_embed and obst_embed
        for (int i = 0; i < self_structure[0][1]; i++) {
            output_embeds[i] = output_0[i];
            output_embeds[i + self_structure[0][1]] = attn_embeds[0][i];
            output_embeds[i + 2 * self_structure[0][1]] = attn_embeds[1][i];
        }
    
        // Feedforward layer
        for (int i = 0; i < self_structure[1][1]; i++) {
            output_1[i] = 0;
            for (int j = 0; j < 3 * self_structure[0][1]; j++) {
                output_1[i] += output_embeds[j] * actor_encoder_feed_forward_0_weight[j][i];
                }
            output_1[i] += actor_encoder_feed_forward_0_bias[i];
            output_1[i] = tanhf(output_1[i]);
        }
    
        for (int i = 0; i < self_structure[2][1]; i++) {
            output_2[i] = 0;
            for (int j = 0; j < self_structure[2][0]; j++) {
                output_2[i] += output_1[j] * action_parameterization_distribution_linear_weight[j][i];
            }
            output_2[i] += action_parameterization_distribution_linear_bias[i];
        }
        
        control_n->thrust_0 = output_2[0];
        control_n->thrust_1 = output_2[1];
        control_n->thrust_2 = output_2[2];
        control_n->thrust_3 = output_2[3];	
    }

void neighborEmbedder(volatile float neighbor_inputs[NEIGHBORS * NBR_OBS_DIM]) {
    
                for (int i = 0; i < nbr_structure[0][1]; i++) {
                    neighbor_embeds[i] = 0; 
                    for (int j = 0; j < nbr_structure[0][0]; j++) {
                        neighbor_embeds[i] += neighbor_inputs[j] * actor_encoder_neighbor_embed_layer_0_weight[j][i]; 
                    }
                    neighbor_embeds[i] += actor_encoder_neighbor_embed_layer_0_bias[i];
               }
        }

void obstacleEmbedder(volatile float obstacle_inputs[OBST_DIM]) {
        //reset embeddings accumulator to zero
        memset(obstacle_embeds, 0, sizeof(obstacle_embeds));

    
                for (int i = 0; i < obst_structure[0][1]; i++) {
                    obstacle_embeds[i] = 0;
                    for (int j = 0; j < obst_structure[0][0]; j++) {
                        obstacle_embeds[i] += obstacle_inputs[j] * actor_encoder_obstacle_embed_layer_0_weight[j][i];
                    }
                    obstacle_embeds[i] += actor_encoder_obstacle_embed_layer_0_bias[i];
                }
            }


void singleHeadAttention() {
        uint8_t i, j, k;
        // fill the tokens matrix with obstacle and neighbor embeddings
        for (i = 0; i < D_MODEL; i++) {
            tokens[0][i] = neighbor_embeds[i];
            tokens[1][i] = obstacle_embeds[i];
        }
        
        // save the residual
        for (i = 0; i < NUM_TOKENS; i++) {
            for (j = 0; j < D_MODEL; j++) {
                residual[i][j] = tokens[i][j];
            }
        }
        
        // compute Q, K, V projection 
        for (i = 0; i < NUM_TOKENS; i++) {
            for (j = 0; j < D_MODEL; j++) {
                q_outputs[i][j] = 0;
                k_outputs[i][j] = 0;
                v_outputs[i][j] = 0;
                for (k = 0; k < D_MODEL; k++) {
                    q_outputs[i][j] += tokens[i][k] * actor_encoder_attention_layer_w_qs_weight[k][j]; 
                    k_outputs[i][j] += tokens[i][k] * actor_encoder_attention_layer_w_ks_weight[k][j];
                    v_outputs[i][j] += tokens[i][k] * actor_encoder_attention_layer_w_vs_weight[k][j];
                }
            }
        }
        
        // compute attention weights and parts of softmax
        for (i = 0; i < NUM_TOKENS; i++) {
            softmax_sums[i] = 0;
            for (int j = 0; j < NUM_TOKENS; j++) {
                attn_weights[i][j] = 0;
                for (k = 0; k < D_MODEL; k++) {
                    attn_weights[i][j] += (q_outputs[i][k] / sqrt((float)D_MODEL)) * k_outputs[j][k];
                }
                softmax_sums[i] += exp(attn_weights[i][j]);
            }
        }
        
        // softmax
        for (i = 0; i < NUM_TOKENS; i++) {
            for (j = 0; j < NUM_TOKENS; j++) {
                attn_weights[i][j] = exp(attn_weights[i][j]) / softmax_sums[i];
            }
        }

        // compute query 
        for (i = 0; i < NUM_TOKENS; i++) {
            for (j = 0; j < D_MODEL; j++) {
                query_output[i][j] = 0;
                for (k = 0; k < NUM_TOKENS; k++) {
                    query_output[i][j] += attn_weights[i][k] * v_outputs[k][j];
                }
            }
        }
        
        // compute the q embeddings 
        for (i = 0; i < NUM_TOKENS; i++) {
            for (j = 0; j < D_MODEL; j++) {
                query_embeds[i][j] = 0;
                for (k = 0; k < D_MODEL; k++) {
                    query_embeds[i][j] += query_output[i][k] * actor_encoder_attention_layer_fc_weight[k][j];
                }
                // add the residual
                query_embeds[i][j] += residual[i][j];
            }
        }
        
        // calculate per-token mean
        for (i = 0; i < NUM_TOKENS; i++){
            last_layer_means[i] = 0;
            for (j = 0; j < D_MODEL; j++) {
                last_layer_means[i] +=  query_embeds[i][j];
            }
            last_layer_means[i] = last_layer_means[i] / (float)D_MODEL;
        }
        
        // calculate per-token variance
        for (i = 0; i < NUM_TOKENS; i++) {
            last_layer_variances[i] = 0;
            for (j = 0; j < D_MODEL; j++) {
                base = query_embeds[i][j] - last_layer_means[i];
                exponent = pow(base, 2);
                last_layer_variances[i] += exponent;
            }
            last_layer_variances[i] = last_layer_variances[i] / (float)(D_MODEL);
        }
        
        // perform layer norm (2x16) x (16)
        for (i = 0; i < NUM_TOKENS; i++) {
            for (j = 0; j < D_MODEL; j++) {
                attn_embeds[i][j] = (query_embeds[i][j] - last_layer_means[i]) / (sqrt(last_layer_variances[i] + EPS)) * actor_encoder_attention_layer_layer_norm_weight[j]; 
                attn_embeds[i][j] += actor_encoder_attention_layer_layer_norm_bias[j]; 
            }
        }
}
