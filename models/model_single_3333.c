
#include "network_evaluate_tof.h"
#include <string.h>


#define EPS 0.000001 // 1e-6

float base;
float exponent;
static const int self_structure [4][2] = {{18, 16},{16, 16},{16, 16},{16, 4}};
static float output_0[16];
static float output_1[16];
static float output_2[16];
static float output_3[4];
static const float actor_encoder_self_encoder_0_weight[18][16] = {{0.022703692317008972,-0.24540090560913086,0.03905177861452103,0.2793407738208771,0.4332103431224823,-0.20495499670505524,-0.1980140209197998,0.0859491378068924,-0.15861758589744568,0.44617605209350586,0.3393796384334564,0.06632500886917114,0.1332339495420456,0.1112966239452362,0.1394066959619522,0.02660449966788292},{0.021520579233765602,0.39004117250442505,-0.19060158729553223,0.056392326951026917,0.3875987231731415,-0.05931096151471138,0.030618546530604362,-0.231654554605484,-0.44048798084259033,-0.05761425197124481,-0.295591801404953,0.08179352432489395,0.13142786920070648,-0.14597947895526886,-0.2753966450691223,-0.02907404489815235},{-0.09114693105220795,-0.19706696271896362,0.0853755846619606,0.09903500974178314,-0.5765546560287476,-0.3145406246185303,-0.17769917845726013,-0.6010844707489014,-0.5043947696685791,-0.03331950679421425,-0.0930926501750946,-0.10924026370048523,0.3184293210506439,-0.2235509157180786,0.3796704411506653,-0.6293004751205444},{0.11882022768259048,0.2696719467639923,-0.07832171767950058,0.19897820055484772,-0.03689107298851013,-0.23443080484867096,0.08499494194984436,-0.007526038680225611,-0.1621266007423401,0.35897278785705566,-0.08921200782060623,-0.2329670786857605,0.19549603760242462,0.42077401280403137,0.029511891305446625,0.23082207143306732},{-0.09623420983552933,0.3717208802700043,-0.10363702476024628,-0.13763146102428436,-0.009829563088715076,0.05904678627848625,0.014695960097014904,-0.07924927771091461,-0.37344110012054443,0.22680509090423584,-0.029141800478100777,0.06520352512598038,0.44085070490837097,0.018425902351737022,-0.155690997838974,-0.17974531650543213},{0.41357338428497314,-0.3548361659049988,0.22155798971652985,0.17552442848682404,0.05997983738780022,-0.29315248131752014,0.15987086296081543,0.00919289980083704,0.03108593262732029,-0.15370146930217743,0.2975831627845764,-0.1358909010887146,0.4401146471500397,-0.268786758184433,0.3998231291770935,0.04319500923156738},{-0.06516148895025253,0.2826688885688782,0.4537551999092102,-0.24109506607055664,-0.12039808928966522,-0.18565109372138977,0.1081194207072258,0.520587682723999,0.1767975091934204,0.432619571685791,-0.38924601674079895,-0.10521728545427322,-0.011027072556316853,-0.10613559186458588,0.3228710889816284,-0.11450470238924026},{-0.06778448820114136,0.3001553416252136,-0.48101866245269775,0.5458773374557495,-0.09120982885360718,-0.15122872591018677,0.34854772686958313,0.1248515173792839,0.16726554930210114,-0.2834389805793762,0.39629361033439636,-0.2437133938074112,-0.16743582487106323,-0.12561021745204926,-0.16220420598983765,0.13267672061920166},{0.2467677891254425,0.10269025713205338,0.20647212862968445,0.5142257809638977,-0.24971076846122742,-0.02286403812468052,-0.1442445069551468,0.05438094213604927,-0.3903587758541107,0.17424345016479492,-0.2658443748950958,-0.3689168393611908,-0.23693355917930603,-0.05691953003406525,-0.0934755951166153,0.15771646797657013},{-0.29477351903915405,0.1989126354455948,-0.2106924057006836,-0.5676023364067078,-0.019866006448864937,-0.28927844762802124,0.08651265501976013,0.4913608729839325,-0.1270603984594345,-0.08153083920478821,0.2829773724079132,-0.17647485435009003,0.1534719616174698,0.11518806964159012,-0.04730059206485748,-0.016973530873656273},{-0.019219135865569115,-0.46219658851623535,0.10317104309797287,-0.38924720883369446,-0.03696843609213829,-0.34709325432777405,-0.32148033380508423,0.4051218628883362,-0.002652438823133707,0.015664733946323395,-0.6085413098335266,-0.4916957914829254,-0.17207776010036469,-0.10327984392642975,0.149871826171875,0.0743405818939209},{-0.3247373104095459,-0.1334625482559204,0.13679851591587067,-0.24862505495548248,0.209197536110878,-0.12640607357025146,-0.012828887440264225,-0.09340589493513107,0.37421876192092896,0.05269745737314224,0.1753281205892563,0.3745545446872711,0.25318557024002075,-0.4868810474872589,0.13807865977287292,-0.380029559135437},{0.04580910876393318,-0.12679775059223175,-0.014309272170066833,0.19455283880233765,0.027726929634809494,-0.12939885258674622,-0.5076666474342346,-0.3262222707271576,0.3150881230831146,0.1910044252872467,0.27511030435562134,0.19633445143699646,-0.4832347631454468,-0.02753235027194023,0.4945877194404602,-0.19297106564044952},{0.0995073914527893,-0.1561756581068039,0.2807430326938629,0.28208670020103455,-0.2895110249519348,-0.6205412745475769,-0.05680153891444206,0.38138025999069214,0.1664419323205948,0.24976028501987457,-0.18755994737148285,-0.23577824234962463,0.0038453235756605864,0.2442253679037094,-0.4627229869365692,-0.33925187587738037},{-0.04394073411822319,0.006267365999519825,-0.2887556850910187,-0.12775520980358124,-0.09972842037677765,-0.2802669405937195,0.13931365311145782,-0.04144285246729851,0.1601620763540268,-0.13210739195346832,-0.08107584714889526,-0.19069044291973114,0.19534127414226532,0.22574298083782196,0.371437132358551,0.2871449291706085},{-0.20929907262325287,0.45723238587379456,0.15599462389945984,0.16847117245197296,0.22521987557411194,-0.13433940708637238,0.28425055742263794,-0.2169930338859558,0.29890891909599304,0.12140976637601852,-0.2446959912776947,-0.09424321353435516,0.04701227322220802,0.09243553876876831,-0.10443775355815887,-0.39931389689445496},{0.09623481333255768,-0.11332888156175613,0.045442454516887665,-0.1568385660648346,-0.2543814480304718,0.00012577934830915183,0.22204209864139557,0.07903321832418442,0.1523323506116867,0.1327286660671234,0.03732439503073692,0.20285356044769287,0.19720667600631714,-0.1988905966281891,-0.048190075904130936,0.14094828069210052},{0.11613103002309799,-0.0665368065237999,-0.181526780128479,0.08108486980199814,-0.047033973038196564,-0.06602662801742554,0.20721763372421265,-0.29902487993240356,0.15432153642177582,-0.20329096913337708,0.13930340111255646,0.25329574942588806,-0.23497842252254486,0.09476576745510101,-0.037698566913604736,0.2043793648481369}};
static const float actor_encoder_self_encoder_2_weight[16][16] = {{-0.22666695713996887,-0.07168938964605331,-0.2784702181816101,0.01789156161248684,0.3611893951892853,0.4141019880771637,-0.3056054711341858,0.18262092769145966,0.31145453453063965,0.04728274047374725,0.18898725509643555,-0.0621001273393631,0.277450293302536,0.21095603704452515,-0.17991246283054352,0.06633556634187698},{-0.12360335886478424,0.2641202509403229,0.37574657797813416,0.11703173071146011,0.18439486622810364,-0.18863292038440704,0.2013806402683258,0.03291229158639908,0.3666178584098816,0.2995808720588684,0.20817361772060394,0.184658020734787,-0.057350482791662216,-0.32059407234191895,0.11438415199518204,-0.041529685258865356},{-0.3690952658653259,-0.35094743967056274,-0.00941568985581398,-0.17206263542175293,-0.01929619535803795,-0.10271220654249191,-0.02873251959681511,0.3232214152812958,-0.08601564168930054,-0.01776563562452793,0.17815551161766052,-0.28801989555358887,-0.28525322675704956,-0.0754639208316803,0.09319707006216049,-0.3589794933795929},{0.4772077798843384,0.06939158588647842,-0.23729750514030457,0.46343204379081726,0.17997588217258453,0.3167436718940735,-0.009901221841573715,0.08633887022733688,-0.29220566153526306,-0.41056886315345764,-0.5982815027236938,-0.19659842550754547,0.2707985043525696,-0.4381493330001831,-0.15636391937732697,-0.01404347363859415},{-0.23984457552433014,-0.02350027672946453,0.4077354371547699,0.09310135990381241,0.27126574516296387,0.2319442331790924,-0.14227813482284546,0.08367183059453964,0.34791865944862366,0.18389372527599335,0.16949798166751862,-0.13395537436008453,-0.18126945197582245,-0.2841354310512543,-0.31708383560180664,-0.14592425525188446},{0.4599073529243469,0.11737246811389923,0.2396920919418335,0.1986408680677414,-0.3267155885696411,0.1344904601573944,-0.26099011301994324,0.1498602330684662,0.1857099086046219,-0.09521599113941193,0.20144955813884735,0.3030731976032257,0.30201613903045654,0.2063566893339157,0.24888652563095093,-0.32890135049819946},{-0.05114418640732765,0.126199409365654,-0.0680287629365921,-0.12709581851959229,0.19091059267520905,0.027847005054354668,0.21412096917629242,0.28575050830841064,0.01839541085064411,-0.07415585219860077,0.2538529932498932,0.20072486996650696,0.3219727873802185,-0.25487035512924194,-0.14384333789348602,0.3296283781528473},{-0.13520391285419464,-0.42672139406204224,0.07847550511360168,0.10754406452178955,-0.43433186411857605,0.3321375250816345,0.4633476734161377,-0.352495938539505,0.4151126742362976,0.07257222384214401,0.26686611771583557,-0.2898018956184387,-0.16167540848255157,0.22983646392822266,-0.4107590913772583,-0.4838596284389496},{0.09104032069444656,0.17548534274101257,-0.1226564571261406,0.45713698863983154,-0.34936270117759705,-0.262521356344223,-0.11498742550611496,-0.21146921813488007,0.28988033533096313,-0.09341898560523987,-0.28309425711631775,-0.28099027276039124,-0.11780638247728348,-0.038687024265527725,0.23688893020153046,-0.45313501358032227},{0.3811545670032501,-0.10700003802776337,0.33394527435302734,-0.1170310229063034,-0.18339994549751282,0.4197196662425995,0.2359546720981598,-0.05090576037764549,-0.17826102674007416,0.16541899740695953,0.2771960198879242,-0.1772799789905548,-0.2601379454135895,-0.32917433977127075,-0.3255321979522705,0.3149324953556061},{0.29535549879074097,-0.03932790830731392,0.3954990804195404,0.1733122617006302,0.45223838090896606,0.1654268503189087,-0.007838140241801739,-0.27779296040534973,-0.2413480132818222,0.030795704573392868,0.0595531202852726,0.2865276634693146,-0.02689439430832863,-0.30500316619873047,0.18887974321842194,0.21152913570404053},{-0.05429787188768387,-0.17469173669815063,-0.09507983177900314,0.4253164529800415,-0.06521808356046677,-0.3596932888031006,-0.08211102336645126,0.29761001467704773,0.5416657328605652,-0.3989982306957245,0.10116475820541382,-0.20115667581558228,-0.3125324547290802,0.2978910207748413,-0.3109849691390991,0.2800968587398529},{-0.18286722898483276,-0.269765168428421,-0.24401487410068512,0.22778648138046265,0.43586185574531555,-0.32315415143966675,-0.024903981015086174,0.2901895046234131,-0.16357207298278809,-0.25991031527519226,-0.1329784095287323,0.3771538734436035,0.3012879192829132,-0.38280510902404785,-0.3174641728401184,-0.23726236820220947},{0.5255158543586731,0.20515072345733643,-0.045788589864969254,-0.01646730676293373,-0.17311449348926544,0.11833374947309494,0.05165071785449982,-0.2388986349105835,0.2770284116268158,-0.30105867981910706,-0.3721092939376831,-0.17183341085910797,-0.20785000920295715,0.029248228296637535,0.189004048705101,-0.33830180764198303},{-0.3470306396484375,0.3799491822719574,-0.3806522488594055,0.2853655219078064,-0.262130469083786,0.4278561770915985,0.008294913917779922,0.2186952531337738,-0.548240065574646,-0.13231900334358215,-0.1392173320055008,-0.11511467397212982,0.40040352940559387,0.45282018184661865,0.5306826829910278,-0.025150936096906662},{0.45719656348228455,-0.19474580883979797,0.32652032375335693,-0.0775299146771431,0.1999979466199875,-0.1585022509098053,-0.25927260518074036,0.010160931386053562,-0.25823813676834106,0.37841472029685974,0.011057226918637753,-0.06472010165452957,0.05740463733673096,-0.15849201381206512,-0.32726550102233887,-0.18086884915828705}};
static const float actor_encoder_feed_forward_0_weight[16][16] = {{0.6249415874481201,-0.03233193978667259,0.48290273547172546,0.1783771514892578,-0.23662300407886505,-0.08773035556077957,0.3186929225921631,0.24216538667678833,-0.10416384041309357,-0.04528142884373665,-0.05956541374325752,0.4360366463661194,0.2002946138381958,-0.1889260709285736,0.006308694835752249,-0.327515184879303},{0.2379380166530609,-0.04876580834388733,-0.36857038736343384,-0.14625000953674316,0.010470625013113022,-0.2050277441740036,0.32874777913093567,-0.12388353794813156,-0.2512516677379608,0.11828525364398956,-0.12372801452875137,0.25764626264572144,0.2596477270126343,-0.1362873911857605,-0.007554969750344753,-0.05454175919294357},{0.41376495361328125,0.23033247888088226,-0.3403998911380768,0.4767068326473236,-0.5259699821472168,0.03638990595936775,-0.30728864669799805,-0.08466963469982147,0.46011582016944885,0.2786843776702881,0.35935354232788086,-0.032079510390758514,0.3431157171726227,0.017990360036492348,-0.24731241166591644,0.3091501295566559},{-0.21696986258029938,0.3505304157733917,0.018276194110512733,0.38542792201042175,0.42759546637535095,0.005375832784920931,0.24158786237239838,0.10021407157182693,0.21547603607177734,0.141000434756279,0.42721831798553467,-0.2516337037086487,0.1473938524723053,-0.31181907653808594,-0.46127521991729736,-0.2930162847042084},{0.24305348098278046,0.6063143014907837,0.5355584025382996,-0.3869713544845581,0.37058454751968384,-0.2433413714170456,0.14746040105819702,-0.47017133235931396,0.542386531829834,-0.0030558130238205194,0.2033049613237381,0.6496948003768921,-0.09630140662193298,-0.05837918817996979,-0.19066107273101807,-0.07616832107305527},{0.3290652334690094,-0.38204824924468994,-0.04556938633322716,0.15335682034492493,-0.3557952046394348,-0.27526867389678955,-0.2335854470729828,-0.03094514086842537,-0.2038804292678833,0.06431560963392258,-0.38585132360458374,0.41779524087905884,0.30687129497528076,-0.14806616306304932,0.15717585384845734,0.10047376900911331},{-0.27770665287971497,-0.013370717875659466,0.38735562562942505,-0.1619124561548233,-0.09674910455942154,0.06397648900747299,-0.17327944934368134,0.38842785358428955,0.4961147904396057,-0.41884639859199524,0.09714291989803314,0.1573949158191681,-0.24137549102306366,-0.06991907209157944,0.102603979408741,-0.14764869213104248},{-0.05833306908607483,0.2901754677295685,-0.20539666712284088,0.17274409532546997,0.26509344577789307,-0.339900404214859,-0.0275116004049778,-0.3641359210014343,0.22653792798519135,-0.14630350470542908,0.2490064948797226,0.09399362653493881,-0.16902831196784973,-0.05758433789014816,0.2487192302942276,0.3743494749069214},{0.04745808243751526,-0.2552703022956848,-0.20565442740917206,0.324503093957901,-0.37330976128578186,0.1536722034215927,0.356115460395813,-0.11027761548757553,-0.03303986042737961,-0.20216429233551025,0.5401796698570251,0.11599625647068024,-0.01740787737071514,0.07944446057081223,0.09146005660295486,-0.5338492393493652},{0.14153385162353516,-0.2758742868900299,-0.2703743875026703,0.14299754798412323,-0.41223329305648804,0.197342187166214,-0.3943920433521271,0.2410670667886734,0.05422189459204674,-0.3454782962799072,-0.05178610980510712,-0.4111608862876892,0.018854090943932533,-0.36481693387031555,0.35705727338790894,0.4447554051876068},{-0.056326914578676224,-0.10772669315338135,0.26050567626953125,0.21879827976226807,0.2181009203195572,0.46720221638679504,0.39976051449775696,0.12248801440000534,-0.26064303517341614,0.09864392876625061,0.2510828971862793,-0.3144886791706085,-0.33284997940063477,-0.02618989907205105,0.5115411877632141,-0.13813167810440063},{0.31836485862731934,0.178342804312706,0.17699435353279114,-0.3169190287590027,0.15905162692070007,0.30214670300483704,0.04709738492965698,-0.3658459186553955,0.0799204483628273,0.08289304375648499,0.3341221213340759,0.07316826283931732,-0.1955750584602356,0.3179032802581787,-0.06188677251338959,0.26715338230133057},{0.3315224349498749,-0.286613404750824,-0.30814024806022644,0.26045018434524536,0.4393289089202881,0.18545407056808472,-0.41018208861351013,-0.4247682988643646,-0.22226814925670624,0.23568516969680786,0.06346313655376434,0.024536918848752975,-0.1399102509021759,-0.28659719228744507,0.06158999726176262,0.16413691639900208},{0.2671032249927521,0.22242943942546844,0.12684744596481323,-0.10241298377513885,0.18206968903541565,-0.014420431107282639,-0.39634931087493896,-0.08474549651145935,-0.06331399083137512,-0.24395765364170074,-0.12534309923648834,-0.38466116786003113,0.24843934178352356,0.21266670525074005,-0.0028258024249225855,0.006083662621676922},{0.0018700421787798405,0.17545431852340698,-0.2936759889125824,0.38185355067253113,0.37277087569236755,0.42735815048217773,-0.12386982887983322,-0.45549625158309937,0.2644083797931671,0.29371243715286255,0.21297135949134827,0.1369537115097046,0.04622315987944603,-0.22053685784339905,-0.009066015481948853,0.24595187604427338},{-0.3821440637111664,-0.0871676504611969,-0.04047911986708641,-0.31060782074928284,0.1909671276807785,-0.01793474704027176,-0.05025235563516617,-0.4993125796318054,0.17622512578964233,0.3698982298374176,0.3999345004558563,0.3686680793762207,0.30806857347488403,-0.04576974734663963,0.0023515578359365463,0.09545426070690155}};
static const float action_parameterization_distribution_linear_weight[16][4] = {{0.5073831081390381,-0.2747994065284729,0.6447752118110657,0.13470588624477386},{0.3401029407978058,-0.16719850897789001,0.10840389877557755,-0.31199735403060913},{0.35741791129112244,-0.4011121094226837,-0.12703239917755127,-0.19165946543216705},{0.12113773077726364,-0.20764407515525818,0.47649216651916504,0.22523285448551178},{-0.2655537724494934,-0.626248300075531,0.3110915720462799,-0.5596325993537903},{-0.4780976474285126,0.1815800666809082,0.1455954760313034,0.3053416609764099},{0.5206143856048584,0.4844810366630554,-0.13927729427814484,-0.10813766717910767},{-0.22904996573925018,0.4805251359939575,0.2836003601551056,-0.13476276397705078},{0.22025233507156372,0.19421157240867615,-0.15385298430919647,-0.4018871784210205},{0.07877582311630249,-0.49512186646461487,0.3821853697299957,-0.41969114542007446},{0.615107536315918,-0.4656647741794586,0.5301885604858398,0.34759023785591125},{0.1514715701341629,-0.06228834390640259,0.09283726662397385,-0.6839743852615356},{0.17582061886787415,0.18529090285301208,0.47042375802993774,-0.34380602836608887},{0.5117262601852417,-0.38571155071258545,-0.2601649761199951,0.4217376112937927},{0.0990261435508728,0.04599253460764885,-0.23478902876377106,0.5189961791038513},{-0.35219210386276245,0.002460916293784976,-0.3705326020717621,-0.013861414045095444}};
static const float actor_encoder_self_encoder_0_bias[16] = {-0.023096758872270584,0.045745495706796646,-0.0186002254486084,-0.032121527940034866,0.02435884065926075,-0.036185722798109055,-0.04598318040370941,0.05661463364958763,0.08882857859134674,0.05254415050148964,0.1642553210258484,-0.11919441819190979,0.008336006663739681,0.0819355919957161,0.028813069686293602,-0.08632403612136841};
static const float actor_encoder_self_encoder_2_bias[16] = {0.07135982066392899,0.0041703046299517155,0.05487868934869766,0.11626346409320831,0.030599422752857208,0.04222015663981438,0.06669586151838303,-0.01801731437444687,0.019164789468050003,-0.04516643285751343,0.04901246726512909,-0.06668511778116226,-0.008962500840425491,0.03052077442407608,-0.0010092600714415312,-0.02827124111354351};
static const float actor_encoder_feed_forward_0_bias[16] = {0.051589567214250565,0.06597749143838882,0.05182747170329094,0.07354956865310669,0.015706447884440422,0.0012893518432974815,0.010828950442373753,0.08700671792030334,0.08050942420959473,0.032772623002529144,0.022653577849268913,-0.016201946884393692,0.12641052901744843,0.039436206221580505,-0.0021396654192358255,-0.07947152853012085};
static const float action_parameterization_distribution_linear_bias[4] = {0.0563315711915493,0.060165077447891235,0.06736888736486435,0.007980011403560638};
void networkEvaluate(struct control_t_n *control_n, const float *state_array) {
        for (int i = 0; i < self_structure[0][1]; i++) {
            output_0[i] = 0;
            for (int j = 0; j < self_structure[0][0]; j++) {
                output_0[i] += state_array[j] * actor_encoder_self_encoder_0_weight[j][i];
            }
            output_0[i] += actor_encoder_self_encoder_0_bias[i];
            output_0[i] = tanhf(output_0[i]);
        }
        
        for (int i = 0; i < self_structure[1][1]; i++) {
            output_1[i] = 0;
            for (int j = 0; j < self_structure[1][0]; j++) {
                output_1[i] += output_0[j] * actor_encoder_self_encoder_2_weight[j][i];
            }
            output_1[i] += actor_encoder_self_encoder_2_bias[i];
            output_1[i] = tanhf(output_1[i]);
        }
            
        // Feedforward layer
        for (int i = 0; i < self_structure[2][1]; i++) {
            output_2[i] = 0;
            for (int j = 0; j < self_structure[2][0]; j++) {
                output_2[i] += output_1[j] * actor_encoder_feed_forward_0_weight[j][i];
                }
            output_2[i] += actor_encoder_feed_forward_0_bias[i];
            output_2[i] = tanhf(output_2[i]);
        }
    
        for (int i = 0; i < self_structure[3][1]; i++) {
            output_3[i] = 0;
            for (int j = 0; j < self_structure[3][0]; j++) {
                output_3[i] += output_2[j] * action_parameterization_distribution_linear_weight[j][i];
            }
            output_3[i] += action_parameterization_distribution_linear_bias[i];
        }
        
        control_n->thrust_0 = output_3[0];
        control_n->thrust_1 = output_3[1];
        control_n->thrust_2 = output_3[2];
        control_n->thrust_3 = output_3[3];	
    }

